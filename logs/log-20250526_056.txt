2025-05-26 23:29:48.829 +06:00 [INF] Starting MyApp...
2025-05-26 23:31:18.130 +06:00 [WRN] Failed to determine the https port for redirect.
2025-05-26 23:31:18.259 +06:00 [INF] HTTP POST /Products/Index responded 400 in 120.3838 ms
2025-05-26 23:31:20.122 +06:00 [INF] HTTP POST /Products/Index responded 400 in 3.1039 ms
2025-05-26 23:31:20.743 +06:00 [INF] HTTP POST /Products/Index responded 400 in 3.9071 ms
2025-05-26 23:31:20.743 +06:00 [INF] HTTP POST /Products/Index responded 400 in 3.9070 ms
2025-05-26 23:31:21.062 +06:00 [INF] HTTP POST /Products/Index responded 400 in 0.9414 ms
2025-05-26 23:31:21.063 +06:00 [INF] HTTP POST /Products/Index responded 400 in 0.6488 ms
2025-05-26 23:31:42.005 +06:00 [INF] HTTP POST /Products/Index responded 400 in 0.6223 ms
2025-05-26 23:31:44.135 +06:00 [INF] HTTP POST /Products/Index responded 400 in 0.6199 ms
2025-05-26 23:31:46.811 +06:00 [INF] HTTP POST /Products/Index responded 400 in 0.6588 ms
2025-05-26 23:31:47.664 +06:00 [INF] HTTP POST /Products/Index responded 400 in 0.4611 ms
2025-05-26 23:31:47.665 +06:00 [INF] HTTP POST /Products/Index responded 400 in 0.4478 ms
2025-05-26 23:31:48.005 +06:00 [INF] HTTP POST /Products/Index responded 400 in 0.4931 ms
2025-05-26 23:31:48.007 +06:00 [INF] HTTP POST /Products/Index responded 400 in 0.5004 ms
2025-05-26 23:32:45.936 +06:00 [INF] HTTP POST /Products/Index responded 400 in 5.4156 ms
2025-05-26 23:35:27.972 +06:00 [INF] HTTP GET /Products responded 200 in 1450.8141 ms
2025-05-26 23:35:28.024 +06:00 [INF] HTTP GET /css/home.css responded 404 in 0.1415 ms
2025-05-26 23:35:28.024 +06:00 [INF] HTTP GET /images/placeholder.png responded 404 in 0.1613 ms
2025-05-26 23:35:28.132 +06:00 [INF] HTTP GET /Products responded 200 in 88.2370 ms
2025-05-26 23:41:00.408 +06:00 [INF] HTTP GET /Products responded 200 in 303.1862 ms
2025-05-26 23:41:00.408 +06:00 [INF] HTTP GET /Products responded 200 in 292.5210 ms
2025-05-26 23:41:00.448 +06:00 [INF] HTTP GET /css/home.css responded 404 in 0.1493 ms
2025-05-26 23:41:00.464 +06:00 [INF] HTTP GET /images/placeholder.png responded 404 in 0.1188 ms
2025-05-26 23:41:13.454 +06:00 [INF] HTTP GET /Products responded 200 in 14.4840 ms
2025-05-26 23:41:13.459 +06:00 [INF] HTTP GET /Products responded 200 in 11.1757 ms
2025-05-26 23:41:13.478 +06:00 [INF] HTTP GET /css/home.css responded 404 in 0.0732 ms
2025-05-26 23:41:13.484 +06:00 [INF] HTTP GET /images/placeholder.png responded 404 in 0.1136 ms
2025-05-26 23:41:13.532 +06:00 [INF] HTTP GET /Products responded 200 in 4.2088 ms
2025-05-26 23:41:14.649 +06:00 [INF] HTTP GET /Products responded 200 in 8.7035 ms
2025-05-26 23:41:14.657 +06:00 [INF] HTTP GET /Products responded 200 in 8.3670 ms
2025-05-26 23:41:14.686 +06:00 [INF] HTTP GET /css/home.css responded 404 in 0.1572 ms
2025-05-26 23:41:14.690 +06:00 [INF] HTTP GET /images/placeholder.png responded 404 in 0.5319 ms
2025-05-26 23:41:14.769 +06:00 [INF] HTTP GET /Products responded 200 in 4.3775 ms
2025-05-26 23:41:17.342 +06:00 [INF] HTTP GET /Products responded 200 in 8.5840 ms
2025-05-26 23:41:17.343 +06:00 [INF] HTTP GET /Products responded 200 in 4.1028 ms
2025-05-26 23:41:17.362 +06:00 [INF] HTTP GET /css/home.css responded 404 in 0.0689 ms
2025-05-26 23:41:17.366 +06:00 [INF] HTTP GET /images/placeholder.png responded 404 in 0.0655 ms
2025-05-26 23:41:17.408 +06:00 [INF] HTTP GET /Products responded 200 in 3.3704 ms
2025-05-26 23:41:22.638 +06:00 [INF] HTTP GET /Products/Index responded 200 in 5.3129 ms
2025-05-26 23:41:22.679 +06:00 [INF] HTTP GET /css/home.css responded 404 in 0.1411 ms
2025-05-26 23:41:22.683 +06:00 [INF] HTTP GET /images/placeholder.png responded 404 in 0.1573 ms
2025-05-26 23:41:22.708 +06:00 [INF] HTTP GET /Products/Index responded 200 in 4.9680 ms
2025-05-26 23:41:27.702 +06:00 [INF] HTTP POST /api/Carts responded 400 in 60.7810 ms
2025-05-26 23:42:54 [Information] Starting MyApp...
2025-05-26 23:42:59 [Warning] Failed to determine the https port for redirect.
2025-05-26 23:43:00 [Information] HTTP "GET" "/api/Carts" responded 200 in 1782.1195 ms
2025-05-26 23:43:10 [Information] HTTP "GET" "/Products/Index" responded 200 in 140.4999 ms
2025-05-26 23:43:10 [Information] HTTP "GET" "/css/home.css" responded 404 in 2.2830 ms
2025-05-26 23:43:10 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 1.3819 ms
2025-05-26 23:43:10 [Information] HTTP "GET" "/Products/Index" responded 200 in 86.5701 ms
2025-05-26 23:43:16 [Information] HTTP "POST" "/api/Carts" responded 400 in 29.2336 ms
2025-05-26 23:43:45 [Information] HTTP "GET" "/Products/Index" responded 200 in 12.4064 ms
2025-05-26 23:43:45 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.1254 ms
2025-05-26 23:43:45 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.1173 ms
2025-05-26 23:43:45 [Information] HTTP "GET" "/Products/Index" responded 200 in 3.3100 ms
2025-05-26 23:43:49 [Information] HTTP "GET" "/Products/Index" responded 200 in 12.5695 ms
2025-05-26 23:43:49 [Information] HTTP "GET" "/Products/Index" responded 200 in 5.0091 ms
2025-05-26 23:43:49 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0720 ms
2025-05-26 23:43:49 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.1263 ms
2025-05-26 23:43:49 [Information] HTTP "GET" "/Products/Index" responded 200 in 2.8374 ms
2025-05-26 23:43:51 [Information] HTTP "GET" "/Products/Index" responded 200 in 15.9940 ms
2025-05-26 23:43:51 [Information] HTTP "GET" "/Products/Index" responded 200 in 2.7553 ms
2025-05-26 23:43:51 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.1120 ms
2025-05-26 23:43:51 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.1023 ms
2025-05-26 23:43:51 [Information] HTTP "GET" "/Products/Index" responded 200 in 3.0998 ms
2025-05-26 23:43:54 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.1850 ms
2025-05-26 23:43:54 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.0830 ms
2025-05-26 23:43:58 [Information] HTTP "POST" "/api/Carts" responded 400 in 1.9648 ms
2025-05-26 23:44:18 [Information] HTTP "POST" "/api/Carts" responded 400 in 1.1161 ms
2025-05-26 23:45:52 [Information] HTTP "GET" "/Products/Index" responded 200 in 5.8490 ms
2025-05-26 23:45:52 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.1083 ms
2025-05-26 23:45:52 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.1110 ms
2025-05-26 23:45:52 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.1854 ms
2025-05-26 23:45:52 [Information] HTTP "GET" "/Products/Index" responded 200 in 4.0069 ms
2025-05-26 23:46:02 [Information] HTTP "POST" "/api/Carts" responded 400 in 13.9761 ms
2025-05-26 23:46:06 [Information] HTTP "GET" "/Products/Index" responded 200 in 40.0616 ms
2025-05-26 23:46:06 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.1755 ms
2025-05-26 23:46:06 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.2433 ms
2025-05-26 23:46:06 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.1862 ms
2025-05-26 23:46:06 [Information] HTTP "GET" "/Products/Index" responded 200 in 23.1891 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/Products/Index" responded 200 in 6.9603 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.1219 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0924 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.1190 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/Products/Index" responded 200 in 4.4944 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/Products/Index" responded 200 in 5.6773 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.2775 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.1191 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.1393 ms
2025-05-26 23:46:07 [Information] HTTP "GET" "/Products/Index" responded 200 in 5.9217 ms
2025-05-26 23:46:10 [Information] HTTP "GET" "/Products/Index" responded 200 in 4.8842 ms
2025-05-26 23:46:10 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.3350 ms
2025-05-26 23:46:10 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.1040 ms
2025-05-26 23:46:10 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.1629 ms
2025-05-26 23:46:10 [Information] HTTP "GET" "/Products/Index" responded 200 in 3.8713 ms
2025-05-26 23:46:10 [Information] HTTP "GET" "/favicon.ico" responded 404 in 0.0981 ms
2025-05-26 23:46:14 [Information] HTTP "POST" "/api/Carts" responded 400 in 1.3827 ms
2025-05-26 23:46:42 [Information] HTTP "GET" "/Products/Index" responded 200 in 24.9200 ms
2025-05-26 23:46:42 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0971 ms
2025-05-26 23:46:42 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.1260 ms
2025-05-26 23:46:42 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.1134 ms
2025-05-26 23:46:44 [Information] HTTP "GET" "/Products/Index" responded 200 in 24.1220 ms
2025-05-26 23:46:49 [Information] HTTP "POST" "/api/Carts" responded 400 in 20.9542 ms
2025-05-26 23:46:53 [Information] HTTP "POST" "/api/Carts" responded 400 in 0.7166 ms
2025-05-26 23:46:58 [Information] HTTP "GET" "/Products/Index" responded 200 in 14.8248 ms
2025-05-26 23:46:58 [Information] HTTP "GET" "/Products/Index" responded 200 in 13.3993 ms
2025-05-26 23:46:58 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.0878 ms
2025-05-26 23:46:58 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.1399 ms
2025-05-26 23:46:58 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0773 ms
2025-05-26 23:46:58 [Information] HTTP "GET" "/Products/Index" responded 200 in 5.8263 ms
2025-05-26 23:46:59 [Information] HTTP "GET" "/Products/Index" responded 200 in 5.2793 ms
2025-05-26 23:46:59 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.0840 ms
2025-05-26 23:46:59 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0692 ms
2025-05-26 23:46:59 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0791 ms
2025-05-26 23:46:59 [Information] HTTP "GET" "/Products/Index" responded 200 in 13.0616 ms
2025-05-26 23:47:18 [Information] HTTP "GET" "/Products/Index" responded 200 in 11.6198 ms
2025-05-26 23:47:18 [Information] HTTP "GET" "/Products/Index" responded 200 in 16.9414 ms
2025-05-26 23:47:18 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.0541 ms
2025-05-26 23:47:18 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0771 ms
2025-05-26 23:47:18 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0539 ms
2025-05-26 23:47:19 [Information] HTTP "GET" "/Products/Index" responded 200 in 2.5096 ms
2025-05-26 23:47:35 [Error] Failed executing DbCommand ("28"ms) [Parameters=["@p0='?', @p1='?', @p2='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""INSERT INTO \"Carts\" (\"CartId\", \"ProductId\", \"Quantity\")
VALUES (@p0, @p1, @p2);"
2025-05-26 23:47:35 [Error] An exception occurred in the database while saving changes for context type '"MyApp.Infrastructure.Data.AppDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table \"Carts\" violates foreign key constraint \"FK_Carts_Products_ProductId\"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table \"Carts\" violates foreign key constraint \"FK_Carts_Products_ProductId\"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Carts
    ConstraintName: FK_Carts_Products_ProductId
    File: ri_triggers.c
    Line: 2607
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)"
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Carts
    ConstraintName: FK_Carts_Products_ProductId
    File: ri_triggers.c
    Line: 2607
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-05-26 23:47:35 [Error] HTTP "POST" "/api/Carts" responded 500 in 401.1718 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Carts
    ConstraintName: FK_Carts_Products_ProductId
    File: ri_triggers.c
    Line: 2607
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyApp.Infrastructure.Repositories.CartRepository.AddAsync(Cart cart)
   at MyApp.Application.Services.CartService.AddToCartAsync(AddToCartDto dto)
   at MyApp.Api.Controllers.CartsController.Add(AddToCartDto dto)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2025-05-26 23:47:35 [Error] Unhandled Exception: "An error occurred while saving the entity changes. See the inner exception for details."
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Carts
    ConstraintName: FK_Carts_Products_ProductId
    File: ri_triggers.c
    Line: 2607
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyApp.Infrastructure.Repositories.CartRepository.AddAsync(Cart cart)
   at MyApp.Application.Services.CartService.AddToCartAsync(AddToCartDto dto)
   at MyApp.Api.Controllers.CartsController.Add(AddToCartDto dto)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyApp.Api.Middleware.CustomUnauthorizedResponseMiddleware.InvokeAsync(HttpContext context)
2025-05-26 23:47:40 [Information] HTTP "GET" "/Products/Index" responded 200 in 10.4372 ms
2025-05-26 23:47:40 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.1439 ms
2025-05-26 23:47:40 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0349 ms
2025-05-26 23:47:40 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.2413 ms
2025-05-26 23:47:40 [Information] HTTP "GET" "/Products/Index" responded 200 in 3.0926 ms
2025-05-26 23:47:54 [Information] HTTP "GET" "/Products/Index" responded 200 in 2.4920 ms
2025-05-26 23:47:54 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.0874 ms
2025-05-26 23:47:54 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0674 ms
2025-05-26 23:47:54 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0522 ms
2025-05-26 23:47:54 [Information] HTTP "GET" "/Products/Index" responded 200 in 2.1301 ms
2025-05-26 23:48:14 [Information] HTTP "GET" "/Products/Index" responded 200 in 147.0936 ms
2025-05-26 23:48:14 [Information] HTTP "GET" "/Products/Index" responded 200 in 157.3443 ms
2025-05-26 23:48:14 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.0523 ms
2025-05-26 23:48:14 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0493 ms
2025-05-26 23:48:14 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0481 ms
2025-05-26 23:48:14 [Information] HTTP "GET" "/Products/Index" responded 200 in 5.8549 ms
2025-05-26 23:48:25 [Error] Failed executing DbCommand ("4"ms) [Parameters=["@p0='?', @p1='?', @p2='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""INSERT INTO \"Carts\" (\"CartId\", \"ProductId\", \"Quantity\")
VALUES (@p0, @p1, @p2);"
2025-05-26 23:48:25 [Error] An exception occurred in the database while saving changes for context type '"MyApp.Infrastructure.Data.AppDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table \"Carts\" violates foreign key constraint \"FK_Carts_Products_ProductId\"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table \"Carts\" violates foreign key constraint \"FK_Carts_Products_ProductId\"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Carts
    ConstraintName: FK_Carts_Products_ProductId
    File: ri_triggers.c
    Line: 2607
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)"
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Carts
    ConstraintName: FK_Carts_Products_ProductId
    File: ri_triggers.c
    Line: 2607
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-05-26 23:48:25 [Error] HTTP "POST" "/api/Carts" responded 500 in 128.4569 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Carts
    ConstraintName: FK_Carts_Products_ProductId
    File: ri_triggers.c
    Line: 2607
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyApp.Infrastructure.Repositories.CartRepository.AddAsync(Cart cart)
   at MyApp.Application.Services.CartService.AddToCartAsync(AddToCartDto dto)
   at MyApp.Api.Controllers.CartsController.Add(AddToCartDto dto)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2025-05-26 23:48:25 [Error] Unhandled Exception: "An error occurred while saving the entity changes. See the inner exception for details."
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Carts" violates foreign key constraint "FK_Carts_Products_ProductId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Carts
    ConstraintName: FK_Carts_Products_ProductId
    File: ri_triggers.c
    Line: 2607
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyApp.Infrastructure.Repositories.CartRepository.AddAsync(Cart cart)
   at MyApp.Application.Services.CartService.AddToCartAsync(AddToCartDto dto)
   at MyApp.Api.Controllers.CartsController.Add(AddToCartDto dto)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyApp.Api.Middleware.CustomUnauthorizedResponseMiddleware.InvokeAsync(HttpContext context)
2025-05-26 23:50:04 [Information] HTTP "GET" "/Products/Index" responded 200 in 5.8272 ms
2025-05-26 23:50:04 [Information] HTTP "GET" "/Products/Index" responded 200 in 2.5916 ms
2025-05-26 23:50:04 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0767 ms
2025-05-26 23:50:04 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0693 ms
2025-05-26 23:50:04 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.0661 ms
2025-05-26 23:50:04 [Information] HTTP "GET" "/Products/Index" responded 200 in 2.3564 ms
2025-05-26 23:50:08 [Information] HTTP "GET" "/Products/Index" responded 200 in 3.8805 ms
2025-05-26 23:50:08 [Information] HTTP "GET" "/Products/Index" responded 200 in 2.6504 ms
2025-05-26 23:50:08 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.0818 ms
2025-05-26 23:50:08 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0697 ms
2025-05-26 23:50:08 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0635 ms
2025-05-26 23:50:08 [Information] HTTP "GET" "/Products/Index" responded 200 in 2.1576 ms
2025-05-26 23:50:28 [Information] HTTP "POST" "/api/Carts" responded 400 in 11.8358 ms
2025-05-26 23:52:25 [Information] HTTP "GET" "/Products/Index" responded 200 in 3.8479 ms
2025-05-26 23:52:25 [Information] HTTP "GET" "/.well-known/appspecific/com.chrome.devtools.json" responded 404 in 0.0725 ms
2025-05-26 23:52:25 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0681 ms
2025-05-26 23:52:25 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.2803 ms
2025-05-26 23:52:25 [Information] HTTP "GET" "/Products/Index" responded 200 in 4.1255 ms
2025-05-26 23:52:38 [Information] HTTP "POST" "/api/Carts" responded 201 in 102.3568 ms
2025-05-26 23:52:54 [Information] HTTP "GET" "/api/Carts" responded 200 in 9.9146 ms
2025-05-26 23:53:08 [Information] HTTP "GET" "/Products/Index" responded 200 in 3.0458 ms
2025-05-26 23:53:08 [Information] HTTP "GET" "/css/home.css" responded 404 in 0.0381 ms
2025-05-26 23:53:08 [Information] HTTP "GET" "/images/placeholder.png" responded 404 in 0.0628 ms
2025-05-26 23:53:08 [Information] HTTP "GET" "/Products/Index" responded 200 in 4.7752 ms
2025-05-26 23:53:18 [Information] HTTP "POST" "/api/Carts" responded 201 in 122.4727 ms
